{% extends 'base.html' %}
{% block body %}
    <style>

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html body {
            overflow: hidden;
        }

        html {
            overflow: hidden;
        }

        body{
            margin: 0;
            font-family: 'Roboto', sans-serif;
            overflow: hidden;
            text-align: center;
            width: 100%;
            height: 100vh;
            text-align: center;
            background-color: #0b0c0b ;
            color: white;
        }

        .top {
            background: url('../static/images/darkHtml~2.jpg') center/cover;
            height: 25vh;
            width: 100%;
            border-bottom: 10px solid rgba(90, 88, 88, 0.3);
            -webkit-background-clip: padding-box;
            background-clip: padding-box;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .top .topToggle {
            width: 100%;
            text-align: left;
            font-size: 1.5rem;
            margin-left: 1rem;
            padding-top: 0.5rem;
        }

        .topToggle .topTogglestart, .topToggle .topTogglesch {
            color: #ccc;
            cursor: pointer;
        }

        .topToggle .topTogglesch  {
            display: none;
        }

        .topOthers {
            height: 100%;
            width: 100%;
            text-align: center;
            /*padding-top: 0.6rem;
            border-bottom: 1px dashed #ccc;*/
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .top span {
            margin-left: 0.5rem;
            font-size: 1.5rem;
        }

        .top .start, .top .stop, .schstop .schstopBut {
            font-size: 1.2rem;
            background: transparent;
            color: #ccc;
            padding: 1rem 1rem;
            border-radius: 50%;
            text-align: center;
        }

        .top .start:focus, .top .stop:focus, .schstopBut:focus {border-radius: 50%;}
        .top .start:active, .top .stop:active, .schstopBut:active {border-radius: 50%;}

        .top .start {
            /*border: 1px solid green;*/
            border: transparent;
            background-color: green;
            text-transform: lowercase;
            cursor: pointer;
        }

        .top .stop, .schstop .schstopBut {
            /*border: 1px solid #ff3838;*/
            display: none;
            border: transparent;
            background-color: rgb(63, 3, 3);
            text-transform: lowercase;
            cursor: pointer;
        }

        input {
            width: 5rem;
            font-size: 1.2rem;
        }

        .toprow {
            margin-left: 3rem;
        }

        .topSch {
            display: none;
            width: 100%;
            height: 95%;
        }

        .topSch .topSchleft {
            overflow: hidden;
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .topSch .topSchleft .title {
            text-transform: uppercase;
            padding: 0.5rem 0.5rem;
            font-size: 1rem;
        }

        .topSch .topSchleft .title .titleSpan {
            font-size: 1rem;
        }

        .topSchleft input[type="radio"] {
            opacity: 0;
            position: fixed;
            width: 0;
        }

        .topSchleft label {
            background: transparent;
            display: inline-block;
            padding: 5px 10px;
            font-size: 10px;
            border: 0.5px solid rgb(134, 134, 134);
            border-radius: 8px;
            cursor: pointer;
            margin-left: 1rem;
            margin-bottom: 0.5rem;
        }

        .topSchleft label:hover {
            border: 0.5px solid rgba(90, 88, 88, 0.3);
        }

        .topSchleft label:active {
            background-color: rgba(90, 88, 88, 0.3);
            border: 0.5px solid #ccc;
        }

        .topSchleft input[type="radio"]:focus + label {
            border: 0.5px dashed #444;
        }

        .topSchleft input[type="radio"]:checked + label {
            background-color: green;
            border-color: green;
        }

        /* Sch button radio input  end*/  

        .topSch .topSchleft .noDefault {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .topSch .topSchleft .jinja {
           overflow: hidden;
           display: flex;
           flex-direction: column;
           justify-content: center;
        }

        .topSch .topSchleft .schAllBut {
          overflow: hidden;
        }

        .topSch .topSchleft .schstop {
            width: 100%;
            height: auto;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        } 

        .topSch .topSchrgt {
            width: 100%;
            height: auto;
            display: flex;
            justify-content: center;
            margin-bottom: 0.6rem;
        }

        .topSch .topSchrgt span{
            cursor: pointer;
            font-size: 1.2rem;
            padding-left: 1rem;
            padding-right: 1rem;
        }

        .topSch .topSchrgt a{
            text-decoration: none;
            color: white;
            cursor: pointer;
        }

        .topSch .topSchrgt .arrowup {
            display: none;
        }

        .topSch .topSchrgt .fa-shield-alt:hover, 
        .topSch .topSchrgt .fa-shield-alt:active ,
        .topSch .topSchrgt .fa-plus:hover, 
        .topSch .topSchrgt .fa-plus:active, 
        .topSch .topSchrgt .arrow:hover,
        .topSch .topSchrgt .arrowdown:hover{
           color: rgba(128, 126, 126, 0.8);
        }
      
        .down {
            width: 100%;
            height: 75vh;
            text-align: center;
            font-size: 4rem;
            background-color: black;
        }

        .down .bgimg {
            background: url('../static/images/darkHtml2.jpeg') center/cover;
            filter: blur(5px);
            -webkit-filter: blur(5px);
            height: 100%;
        }

        .down .showdown {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2;
            font-family: serif;
        }

        .down .toggle {
            font-size: 1.5rem;
            width: 100%;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            /*float: left;*/
        }

        .toggle .fa-angle-double-up {
            color: rgba(248, 244, 244, 0.5);
            margin-left: 0.5rem;
            cursor: pointer;
        }

        .toggle .fa-angle-double-down {
            color: rgba(241, 12, 12, 0.5); /*#ff3838;*/
            margin-left: 0.5rem;
            cursor: pointer;
            display: none;
        }

        .half2 {
            width: 100vh;
            text-align: center;
            display: block;
            flex-direction: column;
            align-items: center;
            padding-top: 1rem;
            /*border: 2px solid red ;
            justify-content: center;*/
        }   

        .half1 {
            padding-top: 1rem;
            display: none;
            text-transform: uppercase;
        }


        .timer {
            background-color: rgba(0,0,0, 0.5);
            width: 100vh;
            /*border-bottom: 1px dashed white ;
            box-shadow: 0.1px 3px #ccc ;
            border-radius: 50%;
            height: 28rem; 19vh*/
            font-size: 7rem;
            font-weight: 230;
        }

        .timeit {
            width: 100vh;
            margin-top: 5rem
        }

        @media (max-width: 500px) {
            .timer {
                font-size: 4rem;
            }
        }

    </style>

    <div class= 'page'>
        <div class= 'top' data-attr="no">

            <div class="topToggle">
                <span class ='topTogglestart'><i onclick="startOut()" class="fas fa-toggle-off"></i></span>
                <span class="topTogglesch"><i onclick="startIn()" class="fas fa-toggle-on"></i></span>
            </div>

            <div class="topOthers">
                <input class="toprow inpt" type='number' id= 'mins', value =1>
                <span>Minute</span>
                
                <button class=" toprow start" onclick = 'startCount(1, false, 1)'>Start</button>
                
                <button class= " toprow stop" onclick= 'endcount()'>Stop</button>
            </div>

            <div class="topSch">
                <div class="topSchrgt">
                    <span class="plus"><a href="{{ url_for('create_new_db') }}"><i class="fas fa-plus"></i></a></span><br/>
                    <span class='shield'> <a href="{{ url_for('show_db') }}"> <i class="fas fa-shield-alt"></i> </a></span><br/>
                    <span class="arrowdown" onclick="topMoveUD()"> <i class="fas fa-arrow-down"></i> </span>
                    <span class="arrowup" onclick="topMoveUD()"> <i class="fas fa-arrow-up"></i> </span>
                </div>

               <div class="topSchleft">
                   <div class="noDefault"></div>
                   
                    <div class="jinja">
                        {% for row in all_title %}
                            {% if row.default == True %}
                                <div class="title">{{ row.title }} <span class="titleSpan"></span></div>
                            {% endif %}
                        {% endfor %}

                        <div class="schstop">
                            <button class= "schstopBut" onclick= 'endcount()'>Stop</button>
                        </div>
                        
                        <div class="schAllBut">
                            {% for row in all_table %}
                                {% if row.default == True %}
                                    <input id="{{ row.id }}" type="radio" name="schBut" value="{{ row.mins }}" onclick="runTime({{ row.mins }}, {{ row.id }})">
                                    <label for="{{ row.id }}" id="label{{ row.id }}" data-text = '{{ row.name }}'>{{ row.mins }}min {{ row.name }}</label>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                  
                    
                </div>
            </div>    
        </div>


        <div class = 'down'>
            <div class="bgimg"></div>
            <div class="showdown">
                <div class="toggle">
                
                    <i onclick="moveUp()" class="fas fa-angle-double-up"></i> 
                    <i onclick="moveDown()" class="fas fa-angle-double-down"></i> 
                    
                </div>

                <div class= 'half1'>
                    Time's up
                </div>
                
                <div class= 'half2'>
                    
                    <div class = 'timer'>
                        <div class = 'timeit'>
                            <span id = 'minute'></span>m : <span id= 'second'></span>s
                        </div>
                    </div>
                </div>
            </div>
        <div>
    </div>

    <script>
        //prevent scrolling
        document.body.addEventListener('touchmove', function(e){ e.preventDefault(); });
        
        //shorten name to 15 letters
        var label_data = document.querySelectorAll('label');
        for (var i=0; i < label_data.length; i++) {
            var datar = label_data[i].getAttribute('data-text');
            if (datar.length > 15) {
                label_data[i].innerHTML = datar.slice(0, 15) + '...'
            }
        };

       //top toggle into front and all schedule buttons
        var top_start = document.querySelector('.topTogglestart');
        var top_sch = document.querySelector('.topTogglesch');
        var top_others = document.querySelector('.topOthers');
        var top_schd = document.querySelector('.topSch');
        var sch_div_left = document.querySelector('.topSchleft'); //not sure if used
        var no_def = document.querySelector('.noDefault');
        var jinja = document.querySelector('.jinja');
        var arrow_up = document.querySelector('.arrowup');
        var arrow_down = document.querySelector('.arrowdown');
        var tt = document.querySelector('.top');
        var dd = document.querySelector('.down');
        var titleDiv = document.querySelector('.titleSpan');
           
        //var sch_but = document.querySelector('.schBut');

        //if no schedule is selected
        if ($('.jinja').children().length <= 1) {
            no_def.innerHTML = 'No Default Schedule';
        }

        //move to all schedule 
        function startOut() {
            
            top_start.style.display = 'none';
            top_sch.style.display = 'block';
            top_others.style.display = 'none';
            top_schd.style.display = 'block';
        };

        // move to front
        function startIn() {
            top_start.style.display = 'block';
            top_sch.style.display = 'none';
            top_others.style.display = 'flex';
            top_schd.style.display = 'none';
        };

        // arrow up and down
        function topMoveUD() {
            if ($('.arrowup').css('display') === 'none') {
                arrow_up.style.display = 'block';
                arrow_down.style.display = 'none';
                dd.style.display = 'none';
                tt.style.height = '100vh';
                tt.setAttribute('data-attr', 'yes')
                console.log(document.querySelector('.top').getAttribute('data-attr'))
            }
             else if (window.getComputedStyle(arrow_down).display == 'none') {
                arrow_up.style.display = 'none';
                arrow_down.style.display = 'block';
                dd.style.display = 'block';
                tt.style.height = '25vh';
                tt.setAttribute('data-attr', 'no')
                console.log(document.querySelector('.top').getAttribute('data-attr'))
            }
        };


        //run timer on sch button click
        function runTime(min, id){
            
            var labelv = document.querySelector('#label' + id);
            var labelName = labelv.getAttribute('data-text');

            if (labelName.length > 20) {
                labelName = labelName.slice(0, 20) + '...'
            }
            
            titleDiv.innerHTML = '-- ' +labelName
            
            //endcount();
            startCount(min, true, id)
        };

    </script>

    <script>

        //keypad input, enter, try space, etc
        var $input = $('input');
        $(document).on('keydown', function (event) {

            //up-arrow (regular and num-pad)
            if (event.keyCode === 38) {
                $input.val((parseInt($input.val()) + 1));
            //down-arrow (regular and num-pad)
            } else if (event.keyCode === 40) {
                $input.val((parseInt($input.val()) - 1));
            //enter key
            } else if (event.keyCode === 13) {
                event.preventDefault();
                //startt = document.querySelector('.start');
                //stopp = document.querySelector('.stop');
                if ($('.stop').css('display') === 'none'){
                    startCount();
                } else if ($('.start').css('display') === 'none') {
                    endcount();
                }
            }else if (event.key === ' '){
                //space key -- togle down and up
                if ($('.fa-angle-double-up').css('display') === 'none'){
                    moveDown();
                  
                } else if ($('.fa-angle-double-down').css('display') === 'none') {
                    moveUp();
                    var dd = document.querySelector('.down');
                    if (window.getComputedStyle(dd).display === 'none') {
                        dd.style.display = 'block';
                    }
                }
            } else if (event.keyCode === 16) {
                // shift key  -- top toggle back and fort
                if ($('.topTogglestart').css('display') === 'none'){
                    startIn();

                } else if ($('.topTogglesch').css('display') === 'none') {
                    startOut();
                }
            } else if (event.keyCode === 84 ) {
                // key t for arrow up and arrow down
                topMoveUD();
                var tt = document.querySelector('.top');
                if (window.getComputedStyle(tt).display === 'none') {
                   tt.style.display = 'flex';
                   moveDown();
                }
            }
            
            //}else if (event.keyCode === 37) {
            //    // left arrow keyy toogle left to front
            //    if ($('.topTogglestart').css('display') === 'none'){
            //        startIn();
            //    }
            //}else if (event.keyCode === 39) {
            //    // back arrow key ttoggle right to sch
            //    if ($('.topTogglesch').css('display') === 'none') {
            //        startOut();
            //    }
        });

        $('#mins').on({
            keydown: function(e) {
                if (e.keyCode === 32)
                return false;
            },
            change: function() {
                this.value = this.value.replace(/\s/g, "");
            }
        });



    </script>

    <script>

        //timer toggle up and down emoji
        function moveUp() {
            var up = document.querySelector('.fa-angle-double-up')
            var dow = document.querySelector('.fa-angle-double-down')
            var dd = document.querySelector('.down')
            var tt = document.querySelector('.top')
            var half11 = document.querySelector('.half1')
            var half22 = document.querySelector('.half2')
            var tim = document.querySelector('.timer')
            var showDown = document.querySelector('.showdown')
            
            tim.style.textAlign = 'center';
            up.style.display = 'none';
            dow.style.display ='block';

            tt.style.display = 'none';
            dd.style.height = '100vh';
            
            half11.style.paddingTop = '1.5rem';
            //half22.style.paddingTop = '3rem';
            if (window.getComputedStyle(half11).display !== 'none') {
                tim.style.fontSize = '6.5rem';
            } else {
                tim.style.fontSize = '7.2rem';
            }
            //tim.style.fontSize = '7.2rem';

            showDown.style.top = '35%';
        }

        function moveDown() {
            var up = document.querySelector('.fa-angle-double-up');
            var dow = document.querySelector('.fa-angle-double-down');
            var dd = document.querySelector('.down');
            var tt = document.querySelector('.top');
            var tim = document.querySelector('.timer');
            var half11 = document.querySelector('.half1');
            var showDown = document.querySelector('.showdown')
            
            up.style.display = 'block';
            dow.style.display ='none';

            tt.style.display = 'flex';
            dd.style.height = '75vh';
            
            half11.style.paddingTop = '1rem';
            showDown.style.top = '50%';
           
            // if time's up reducr tim to 5 rem
            if (window.getComputedStyle(half11).display === 'none') {
                tim.style.fontSize = '7rem';
            } else {
                tim.style.fontSize = '5rem';
            }
        }
    </script>
        
    <script>
        //stop and start button

        function endcount() {
           // window.location.reload(false)
           window.top.location = window.top.location

        }
        
        
        function startCount(mins, style, id) {
            var startt = document.querySelector('.start')
            var stopp = document.querySelector('.stop')
            var stop_ = stopp.getAttribute('data-attr')
            
            startt.style.display = 'none'
            stopp.style.display = 'block'

            var Min = document.getElementById('mins').value
            //var Sec = document.getElementById('secs').value
            var minc = document.getElementById('minute');
            var secc = document.getElementById('second');
            var half11 = document.querySelector('.half1');
            var timerr = document.querySelector('.timer');
            var tim = document.querySelector('.timer');
            var sch_stop = document.querySelector('.schstopBut');
            var schAllBut = document.querySelector('.schAllBut');
            var no_def = document.querySelector('.noDefault');

            schAllBut.style.display = 'none';
            sch_stop.style.display = 'block';
            no_def.style.display = 'none';
            
            minc.innerHTML = Min
            secc.innerHTML = 0

            if (style) {
                var labelId = document.getElementById('label' + String(id));
                Min = mins;
            }
            
            var tell = Min * 60
        
                    
            var time = tell,
            start = Date.now(),
            //minc = document.getElementById('minute'),
            //secc = document.getElementById('second'),
            timer;
            
            timer = setInterval( function countdown() {
                var timeleft = Math.max(0, time - (Date.now() - start) / 1000),
                    m = Math.floor((timeleft /60 ) ),
                    s = Math.floor(timeleft % 60);
                
                minc.firstChild.nodeValue = m;
                secc.firstChild.nodeValue = s;

                if (timeleft > 300 && timeleft < 600) {
                    timerr.style.borderBottom = '5px solid #4834d4';
                    if (style) {
                        labelId.style.backgroundColor = '#4834d4';
                        labelId.style.borderColor = '#4834d4';
                    }
                }else if (timeleft < 300 ) {
                    timerr.style.borderBottom = '5px solid #F96B00'; //fff200
                    if (style) {
                        labelId.style.backgroundColor = '#F96B00';
                        labelId.style.borderColor = '#F96B00';
                    }
                }else if (timeleft > 600) {
                    timerr.style.borderBottom = '5px solid green';
                    if (style) {
                        labelId.style.backgroundColor = 'green';
                        labelId.style.borderColor = 'green';
                    }
                };
                
                if( timeleft == 0) {

                    clearInterval(timer);
                    //Half1.style.display = 'block';
                    half11.style.display = 'block';
                    half11.style.color = '#ff3838';
                    timerr.style.borderBottom = 'none';
                    timerr.style.borderTop = '5px solid #ff3838';
                    tim.style.fontSize = '5rem';
                    if (style) {
                        labelId.style.backgroundColor = '#ff3838';
                        labelId.style.borderColor = '#ff3838';
                    }


                    var timeN = 1 * 60,
                        startNeg = Date.now(),
                        timeNeg;
                    

                    var timeNeg = setInterval (function negativeCountdown() {
                        var timeneg = Math.max(0, ((Date.now() - startNeg) - timeN )/ 1000),
                            m = Math.floor((timeneg / 60)),
                            s = Math.floor(timeneg % 60);
                        
                            minc.firstChild.nodeValue = - m;
                            secc.firstChild.nodeValue = - s;
                    }, 200)
                };
    
            }, 200);
            
            //timer = setInterval(countdown, 1000);

        }

        

    </script>
{% endblock %}